<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RipzCreator-E | AI Copilot for Anime Creators</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* RipzCreator Aesthetic */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #09090b; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #7c3aed; }
        
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-panel {
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(63, 63, 70, 0.4);
        }
        
        /* VFX ANIMATIONS */
        @keyframes speedLineMove {
            0% { background-position: 0 0; }
            100% { background-position: 100% 100%; }
        }
        .vfx-speedlines {
            background: repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(255, 255, 255, 0.1) 50px, rgba(255, 255, 255, 0.1) 52px);
            animation: speedLineMove 0.2s linear infinite;
            pointer-events: none;
        }
        @keyframes impactPulse {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgba(255, 255, 255, 0.2); }
        }
        .vfx-impact {
            animation: impactPulse 0.1s linear infinite;
            pointer-events: none;
        }
        .vfx-aura {
            box-shadow: inset 0 0 50px 20px rgba(250, 204, 21, 0.3);
            pointer-events: none;
        }
        .vfx-eyes {
            /* Simulating eye glow center screen */
            background: radial-gradient(circle at 50% 45%, rgba(220, 38, 38, 0.6) 0%, transparent 10%),
                        radial-gradient(circle at 55% 45%, rgba(220, 38, 38, 0.6) 0%, transparent 10%);
            pointer-events: none;
        }
        
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active{
            -webkit-box-shadow: 0 0 0 30px #09090b inset !important;
            -webkit-text-fill-color: white !important;
            transition: background-color 5000s ease-in-out 0s;
        }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-300 font-sans selection:bg-violet-500/30 overflow-hidden">

    <!-- App Container -->
    <div id="app" class="h-screen flex flex-col md:flex-row relative">
        
        <!-- Loading Screen -->
        <div id="loading-screen" class="fixed inset-0 z-[60] bg-zinc-950 flex items-center justify-center">
            <div class="animate-spin w-8 h-8 border-2 border-violet-600 border-t-transparent rounded-full"></div>
        </div>

        <!-- Login View -->
        <div id="login-view" class="fixed inset-0 z-50 bg-zinc-950 hidden flex flex-col items-center justify-center p-4">
            <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
                <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-violet-600/20 rounded-full blur-[100px]"></div>
                <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-indigo-600/10 rounded-full blur-[100px]"></div>
            </div>

            <div class="w-full max-w-md glass-panel p-8 rounded-3xl shadow-2xl relative z-10">
                <div class="flex justify-center mb-6">
                   <div class="w-16 h-16 bg-gradient-to-tr from-violet-600 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-violet-500/30">
                     <i data-lucide="zap" class="text-white fill-current w-8 h-8"></i>
                   </div>
                </div>
                
                <h1 class="text-3xl font-bold text-center text-white mb-2 tracking-tight">Ripz<span class="text-violet-500">Creator</span></h1>
                <p class="text-center text-zinc-500 mb-8">The AI Copilot for Anime & Aesthetic Creators</p>
        
                <div id="setup-warning" class="hidden text-center space-y-4 mb-6">
                    <div class="p-4 bg-yellow-900/20 border border-yellow-600/50 rounded-xl text-yellow-200 text-sm">
                        <p class="font-bold mb-2"><i data-lucide="alert-triangle" class="inline w-4 h-4 mr-1"></i> Setup Required</p>
                        <p>To enable the Login System, you must add your Firebase Configuration keys to the code.</p>
                    </div>
                </div>

                <div id="auth-form" class="space-y-4">
                    <div><input type="email" id="email-input" placeholder="Email Address" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl px-4 py-3 text-white placeholder-zinc-600 focus:outline-none focus:ring-2 focus:ring-violet-600/50 transition-all"></div>
                    <div><input type="password" id="password-input" placeholder="Password" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl px-4 py-3 text-white placeholder-zinc-600 focus:outline-none focus:ring-2 focus:ring-violet-600/50 transition-all"></div>

                    <div class="flex gap-3 pt-2">
                        <button onclick="handleEmailAuth('signin')" id="signin-btn" class="flex-1 py-3 bg-white hover:bg-zinc-200 text-black font-bold rounded-xl transition-all">Sign In</button>
                        <button onclick="handleEmailAuth('signup')" id="signup-btn" class="flex-1 py-3 bg-zinc-800 hover:bg-zinc-700 text-white font-bold rounded-xl transition-all border border-zinc-700">Sign Up</button>
                    </div>

                    <div class="relative flex py-2 items-center">
                        <div class="flex-grow border-t border-zinc-800"></div>
                        <span class="flex-shrink mx-4 text-zinc-600 text-xs uppercase">Or</span>
                        <div class="flex-grow border-t border-zinc-800"></div>
                    </div>

                    <button onclick="handleGuestLogin()" id="guest-btn" class="w-full py-3 bg-transparent hover:bg-zinc-800/50 text-zinc-400 font-medium rounded-xl transition-all flex items-center justify-center gap-2 border border-zinc-800 border-dashed">
                        <span>Continue as Guest</span>
                    </button>

                    <p id="login-error" class="text-center text-red-400 text-sm hidden bg-red-950/30 p-2 rounded-lg border border-red-900/50"></p>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-64 bg-zinc-950 border-r border-zinc-800 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col">
            <div class="p-6 border-b border-zinc-800 flex items-center justify-between">
                <div class="flex items-center gap-2 text-violet-500">
                    <i data-lucide="zap" class="fill-current w-6 h-6"></i>
                    <h1 class="text-xl font-bold tracking-tighter text-white">Ripz<span class="text-violet-500">Creator</span></h1>
                </div>
                <button onclick="toggleSidebar()" class="md:hidden text-zinc-400 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>

            <nav class="flex-1 overflow-y-auto p-4 space-y-1">
                <p class="px-4 text-[10px] font-bold text-zinc-600 uppercase tracking-widest mb-2 mt-2">Core</p>
                <button onclick="switchView('script')" id="nav-script" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all bg-violet-600/20 text-violet-300 border border-violet-600/50">
                  <i data-lucide="file-text" class="w-5 h-5"></i> <span class="font-medium">Script Gen</span>
                </button>
                
                <p class="px-4 text-[10px] font-bold text-zinc-600 uppercase tracking-widest mb-2 mt-6">Production Studio</p>
                <button onclick="switchView('autoedit')" id="nav-autoedit" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-zinc-400 hover:bg-zinc-900 hover:text-white">
                  <i data-lucide="wand-2" class="w-5 h-5"></i> <span class="font-medium">Magic Edit</span>
                  <span class="ml-auto text-[10px] bg-violet-600 text-white px-1.5 rounded">NEW</span>
                </button>
                <button onclick="switchView('scene')" id="nav-scene" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-zinc-400 hover:bg-zinc-900 hover:text-white">
                  <i data-lucide="clapperboard" class="w-5 h-5"></i> <span class="font-medium">Scene Builder</span>
                </button>
                <button onclick="switchView('factory')" id="nav-factory" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-zinc-400 hover:bg-zinc-900 hover:text-white">
                  <i data-lucide="box" class="w-5 h-5"></i> <span class="font-medium">Asset Lab</span>
                </button>
                <button onclick="switchView('vfx')" id="nav-vfx" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-zinc-400 hover:bg-zinc-900 hover:text-white">
                  <i data-lucide="activity" class="w-5 h-5"></i> <span class="font-medium">VFX Studio</span>
                </button>

                <div class="mt-8">
                  <h3 class="px-4 text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-2">History</h3>
                  <div id="history-list" class="space-y-1"><p class="px-4 text-xs text-zinc-600 italic">No history yet.</p></div>
                </div>
            </nav>

            <div class="p-4 border-t border-zinc-800">
                <div class="flex items-center gap-3 px-2 mb-4">
                  <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-violet-500 to-fuchsia-500 flex items-center justify-center text-xs font-bold text-white" id="user-avatar">GU</div>
                  <div class="flex-1 overflow-hidden">
                    <p class="text-sm font-medium text-white truncate" id="user-email">Guest User</p>
                    <p id="plan-status" class="text-xs text-zinc-500 truncate">Pro Plan Active</p>
                  </div>
                </div>
                <button onclick="handleSignOut()" class="w-full flex items-center justify-center gap-2 p-2 text-xs text-zinc-500 hover:text-red-400 transition-colors">
                  <i data-lucide="log-out" class="w-4 h-4"></i> Sign Out
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto relative scroll-smooth bg-zinc-950 w-full p-6 md:p-10 pb-20">
            
            <!-- Mobile Header -->
            <div class="md:hidden flex items-center justify-between mb-6">
                <div class="flex items-center gap-2">
                    <i data-lucide="zap" class="text-violet-500 fill-current w-5 h-5"></i>
                    <span class="font-bold text-white">RipzCreator</span>
                </div>
                <button onclick="toggleSidebar()" class="text-white"><i data-lucide="menu" class="w-6 h-6"></i></button>
            </div>

            <!-- VIEW: Script Generator (Default) -->
            <div id="view-script" class="view-section fade-in">
                <div class="flex flex-col gap-2 mb-8">
                    <h2 class="text-3xl font-bold text-white tracking-tight">Script Generator</h2>
                    <p class="text-zinc-500">The core brain. Generate high-retention hooks and scripts.</p>
                </div>
                
                <div class="glass-panel rounded-2xl p-6 mb-8">
                    <div class="flex flex-col md:flex-row gap-4">
                      <div class="flex-1">
                        <label class="block text-xs font-bold text-violet-400 uppercase tracking-widest mb-2">Topic</label>
                        <input type="text" id="topic-input" placeholder="E.g., Why Gojo Satoru is actually the villain..." class="w-full bg-zinc-950 border border-zinc-800 rounded-xl px-4 py-3 text-white placeholder-zinc-600 focus:outline-none focus:ring-2 focus:ring-violet-600/50 transition-all" onkeydown="if(event.key === 'Enter') generateContent()">
                      </div>
                      <div class="w-full md:w-48">
                        <label class="block text-xs font-bold text-violet-400 uppercase tracking-widest mb-2">Tone</label>
                        <select id="tone-select" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-violet-600/50 appearance-none">
                          <option value="dramatic">Dramatic Analysis</option>
                          <option value="chill">Chill Video Essay</option>
                          <option value="hype">Hype / AMV Style</option>
                          <option value="horror">Horror / Mystery</option>
                        </select>
                      </div>
                      <div class="flex items-end">
                        <button onclick="generateContent()" id="generate-btn" class="h-[50px] px-6 rounded-xl font-bold text-white shadow-lg shadow-violet-900/20 flex items-center justify-center gap-2 transition-all bg-gradient-to-r from-violet-600 to-indigo-600 hover:scale-105 active:scale-95 whitespace-nowrap">
                            <i data-lucide="sparkles" class="w-4 h-4"></i> Generate
                        </button>
                      </div>
                    </div>
                </div>

                <div id="results-container" class="space-y-6 hidden"></div>
                <div id="api-key-warning" class="hidden p-4 bg-yellow-900/20 border border-yellow-500/50 text-yellow-200 rounded-xl flex flex-col items-center justify-center gap-2 mt-4 text-center">
                    <div class="flex items-center gap-2 font-bold"><i data-lucide="key" class="w-5 h-5 text-yellow-400"></i><span>Missing Gemini API Key</span></div>
                    <p class="text-sm">Paste your key in the code at Line ~600.</p>
                </div>
            </div>

            <!-- VIEW: Auto-Edit (Magic Edit) -->
            <div id="view-autoedit" class="view-section hidden fade-in">
                <div class="flex flex-col gap-2 mb-8">
                    <h2 class="text-3xl font-bold text-white tracking-tight">Magic Edit Engine</h2>
                    <p class="text-zinc-500">Auto-trim, beat-sync, and anime color grading in one click.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 glass-panel rounded-2xl p-8 border-dashed border-2 border-zinc-800 hover:border-violet-500 transition-colors flex flex-col items-center justify-center min-h-[300px] relative overflow-hidden group">
                        <div id="upload-state" class="text-center z-10">
                            <div class="w-20 h-20 bg-zinc-900 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-violet-900/10">
                                <i data-lucide="upload-cloud" class="w-10 h-10 text-violet-500"></i>
                            </div>
                            <h3 class="text-xl font-bold text-white mb-2">Drop Raw Footage</h3>
                            <p class="text-zinc-500 text-sm max-w-xs mx-auto">Supports MP4, MOV, WEBM. Up to 2GB.</p>
                            <button onclick="startAutoEdit()" class="mt-6 px-6 py-2 bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg font-medium transition-colors">Select Files</button>
                        </div>

                        <div id="processing-state" class="hidden absolute inset-0 bg-black/90 z-20 flex flex-col items-center justify-center p-8 w-full">
                            <div class="w-full max-w-md space-y-4">
                                <div class="flex justify-between text-xs font-mono text-violet-400">
                                    <span id="process-stage">ANALYZING AUDIO...</span>
                                    <span id="process-percent">0%</span>
                                </div>
                                <div class="w-full bg-zinc-800 h-2 rounded-full overflow-hidden">
                                    <div id="progress-bar" class="h-full bg-violet-500 w-0 transition-all duration-300"></div>
                                </div>
                                <div class="h-32 bg-zinc-900 rounded-lg p-3 font-mono text-[10px] text-zinc-400 overflow-hidden border border-zinc-800 opacity-80" id="terminal-log">
                                    > Init AI Core...<br>
                                </div>
                            </div>
                        </div>

                        <div id="success-state" class="hidden absolute inset-0 bg-zinc-950 z-30 flex flex-col items-center justify-center p-8">
                             <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mb-4 text-green-400">
                                <i data-lucide="check" class="w-8 h-8"></i>
                             </div>
                             <h3 class="text-xl font-bold text-white">Edit Complete</h3>
                             <p class="text-zinc-500 text-sm mb-6">Synced to 128 BPM. 4 Lighting fixes applied.</p>
                             <div class="flex gap-3">
                                <button onclick="simulateDownload()" class="px-4 py-2 bg-white text-black font-bold rounded-lg hover:bg-zinc-200">Download</button>
                                <button onclick="resetAutoEdit()" class="px-4 py-2 bg-zinc-800 text-white rounded-lg hover:bg-zinc-700">New Project</button>
                             </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="glass-panel p-5 rounded-xl">
                            <h4 class="text-sm font-bold text-white mb-4 flex items-center gap-2"><i data-lucide="sliders" class="w-4 h-4 text-violet-500"></i> AI Settings</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="text-xs text-zinc-500 font-bold uppercase block mb-2">Edit Style</label>
                                    <select class="w-full bg-zinc-950 border border-zinc-800 rounded-lg p-2 text-sm text-white">
                                        <option>Anime Flow (Smooth)</option>
                                        <option>Hard Sync (Aggressive)</option>
                                        <option>Documentary (Slow)</option>
                                    </select>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-zinc-900 rounded-lg border border-zinc-800">
                                    <span class="text-sm text-zinc-300">Stabilization</span>
                                    <div class="w-10 h-5 bg-violet-600 rounded-full relative"><div class="absolute right-1 top-1 w-3 h-3 bg-white rounded-full"></div></div>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-zinc-900 rounded-lg border border-zinc-800">
                                    <span class="text-sm text-zinc-300">Auto-Color Grade</span>
                                    <div class="w-10 h-5 bg-violet-600 rounded-full relative"><div class="absolute right-1 top-1 w-3 h-3 bg-white rounded-full"></div></div>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-zinc-900 rounded-lg border border-zinc-800">
                                    <span class="text-sm text-zinc-300">Beat Sync</span>
                                    <div class="w-10 h-5 bg-violet-600 rounded-full relative"><div class="absolute right-1 top-1 w-3 h-3 bg-white rounded-full"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

             <!-- VIEW: Scene Builder -->
             <div id="view-scene" class="view-section hidden fade-in">
                <div class="flex flex-col gap-2 mb-8">
                    <h2 class="text-2xl font-bold text-white">Anime Scene Builder</h2>
                    <p class="text-zinc-500 text-sm">Generative storytelling. Text to fully animated scene storyboard.</p>
                </div>

                <div class="glass-panel p-6 rounded-2xl mb-6">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <label class="text-xs font-bold text-zinc-500 uppercase mb-2 block">Story Prompt</label>
                            <textarea id="scene-prompt" rows="3" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-4 text-white placeholder-zinc-700 focus:outline-none focus:border-violet-500 resize-none" placeholder="A cyberpunk samurai standing in rain, neon lights reflecting on katana..."></textarea>
                        </div>
                        <div class="w-full md:w-64 flex flex-col gap-2">
                            <label class="text-xs font-bold text-zinc-500 uppercase mb-2 block">Settings</label>
                            <div class="flex items-center gap-2 p-2 bg-zinc-900 rounded-lg border border-zinc-800">
                                <input type="checkbox" checked class="accent-violet-600">
                                <span class="text-xs text-zinc-400">Wide Shot</span>
                            </div>
                            <div class="flex items-center gap-2 p-2 bg-zinc-900 rounded-lg border border-zinc-800">
                                <input type="checkbox" checked class="accent-violet-600">
                                <span class="text-xs text-zinc-400">Action Shot</span>
                            </div>
                            <button onclick="generateScene()" id="scene-btn" class="flex-1 bg-white text-black font-bold rounded-lg hover:bg-zinc-200 transition-colors">Generate Storyboard</button>
                        </div>
                    </div>
                </div>

                <!-- Scene Results Area -->
                <div id="scene-results" class="hidden grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Images will be injected here -->
                </div>
                
                <div id="scene-loading" class="hidden h-64 glass-panel rounded-2xl border border-zinc-800 flex flex-col items-center justify-center">
                    <div class="animate-spin w-8 h-8 border-2 border-violet-600 border-t-transparent rounded-full mb-4"></div>
                    <div class="animate-pulse text-violet-500 font-mono text-sm">GENERATING STORYBOARD...</div>
                </div>
            </div>

            <!-- VIEW: Asset Factory -->
            <div id="view-factory" class="view-section hidden fade-in">
                 <div class="flex flex-col gap-2 mb-8">
                    <h2 class="text-2xl font-bold text-white">Asset Lab</h2>
                    <p class="text-zinc-500 text-sm">Generative characters, backgrounds, and SFX.</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-1 space-y-4">
                        <div class="glass-panel p-5 rounded-xl">
                            <label class="text-xs font-bold text-zinc-500 uppercase mb-2 block">Asset Type</label>
                            <div class="grid grid-cols-2 gap-2 mb-4">
                                <button onclick="selectAssetType(this, 'Character')" class="asset-btn bg-violet-600 text-white p-2 rounded-lg text-xs font-bold border border-violet-500">Character</button>
                                <button onclick="selectAssetType(this, 'Background')" class="asset-btn bg-zinc-900 text-zinc-400 p-2 rounded-lg text-xs font-bold border border-zinc-800">Background</button>
                                <button onclick="selectAssetType(this, 'Thumbnail')" class="asset-btn bg-zinc-900 text-zinc-400 p-2 rounded-lg text-xs font-bold border border-zinc-800">Thumbnail</button>
                                <button onclick="selectAssetType(this, 'SFX')" class="asset-btn bg-zinc-900 text-zinc-400 p-2 rounded-lg text-xs font-bold border border-zinc-800">SFX</button>
                            </div>
                            <textarea id="asset-prompt" class="w-full bg-zinc-950 border border-zinc-800 rounded-lg p-3 text-sm text-white mb-4" rows="4" placeholder="Describe asset..."></textarea>
                            <button onclick="generateAsset()" id="asset-gen-btn" class="w-full py-2 bg-white text-black font-bold rounded-lg hover:bg-zinc-200">Generate</button>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                         <div id="asset-placeholder" class="h-[400px] border-2 border-dashed border-zinc-800 rounded-2xl flex items-center justify-center text-zinc-600">
                             <div class="text-center">
                                 <i data-lucide="layers" class="w-10 h-10 mx-auto mb-2 opacity-50"></i>
                                 <p class="text-sm">Assets will render here</p>
                             </div>
                         </div>
                         <div id="asset-result" class="hidden h-[400px] bg-black rounded-2xl relative overflow-hidden group">
                             <div class="absolute inset-0 bg-gradient-to-br from-violet-900/40 to-black"></div>
                             <div class="absolute inset-0 flex items-center justify-center">
                                 <div class="text-center p-8">
                                     <i data-lucide="image" class="w-16 h-16 text-violet-400 mx-auto mb-4"></i>
                                     <h3 class="text-2xl font-bold text-white mb-2" id="asset-title">Asset Name</h3>
                                     <p class="text-zinc-400 text-sm max-w-md mx-auto italic" id="asset-desc">...</p>
                                     <div class="mt-8 flex justify-center gap-4">
                                         <button onclick="simulateDownload()" class="px-6 py-2 bg-violet-600 text-white rounded-full font-bold hover:scale-105 transition-transform">Download</button>
                                     </div>
                                 </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: VFX Studio -->
            <div id="view-vfx" class="view-section hidden fade-in">
                <div class="flex flex-col gap-2 mb-8">
                    <h2 class="text-3xl font-bold text-white tracking-tight">VFX Studio</h2>
                    <p class="text-zinc-500">Motion tracking and Anime VFX layers.</p>
                </div>

                <div class="glass-panel rounded-2xl p-1 overflow-hidden relative">
                    <div class="bg-black aspect-video relative flex items-center justify-center overflow-hidden">
                        <!-- Video Placeholder -->
                        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1535905557558-afc4877a26fc?q=80&w=2574&auto=format&fit=crop')] bg-cover bg-center opacity-60"></div>
                        
                        <!-- VFX Overlays (Toggled via JS) -->
                        <div id="vfx-layer-aura" class="absolute inset-0 vfx-aura opacity-0 transition-opacity duration-300"></div>
                        <div id="vfx-layer-eyes" class="absolute inset-0 vfx-eyes opacity-0 transition-opacity duration-300 mix-blend-screen"></div>
                        <div id="vfx-layer-lines" class="absolute inset-0 vfx-speedlines opacity-0 transition-opacity duration-300"></div>
                        <div id="vfx-layer-impact" class="absolute inset-0 vfx-impact opacity-0 transition-opacity duration-100"></div>

                        <!-- HUD -->
                        <div class="relative z-10 text-center">
                             <div class="w-24 h-24 border border-violet-500/30 rounded-full absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></div>
                             <p id="vfx-hud" class="font-mono text-violet-400 text-xs bg-black/50 px-2 py-1 mt-32">TRACKING: IDLE</p>
                        </div>
                        <div class="absolute top-4 left-4 text-[10px] font-mono text-zinc-500">REC 00:00:12:04</div>
                        <div class="absolute bottom-4 right-4 text-[10px] font-mono text-zinc-500">1080P 60FPS</div>
                    </div>
                    
                    <div class="p-6 grid grid-cols-2 md:grid-cols-4 gap-4 bg-zinc-900/50">
                        <button onclick="toggleVFX(this, 'aura')" class="vfx-btn p-4 bg-zinc-950 border border-zinc-800 rounded-xl hover:border-violet-500 hover:bg-zinc-900 transition-all text-left group">
                            <i data-lucide="zap" class="w-6 h-6 text-yellow-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <div class="text-sm font-bold text-white">Super Aura</div>
                        </button>
                        <button onclick="toggleVFX(this, 'eyes')" class="vfx-btn p-4 bg-zinc-950 border border-zinc-800 rounded-xl hover:border-violet-500 hover:bg-zinc-900 transition-all text-left group">
                            <i data-lucide="eye" class="w-6 h-6 text-red-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <div class="text-sm font-bold text-white">Evil Eyes</div>
                        </button>
                        <button onclick="toggleVFX(this, 'lines')" class="vfx-btn p-4 bg-zinc-950 border border-zinc-800 rounded-xl hover:border-violet-500 hover:bg-zinc-900 transition-all text-left group">
                            <i data-lucide="wind" class="w-6 h-6 text-blue-400 mb-2 group-hover:scale-110 transition-transform"></i>
                            <div class="text-sm font-bold text-white">Speed Lines</div>
                        </button>
                        <button onclick="toggleVFX(this, 'impact')" class="vfx-btn p-4 bg-zinc-950 border border-zinc-800 rounded-xl hover:border-violet-500 hover:bg-zinc-900 transition-all text-left group">
                            <i data-lucide="move" class="w-6 h-6 text-green-400 mb-2 group-hover:scale-110 transition-transform"></i>
                            <div class="text-sm font-bold text-white">Impact</div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Error/Success Message Toast -->
            <div id="toast-box" class="fixed bottom-6 right-6 hidden p-4 bg-zinc-900 border border-violet-500/50 text-white rounded-xl flex items-center gap-3 shadow-2xl z-50 animate-bounce">
                <i id="toast-icon" data-lucide="info" class="w-5 h-5 text-violet-400"></i>
                <span id="toast-text">Notification</span>
            </div>

        </main>
        
        <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/80 z-30 hidden md:hidden backdrop-blur-sm"></div>
    </div>

    <!-- APP LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // ==========================================
        //  CONFIG: PASTE KEYS HERE
        // ==========================================
        const manualConfig = {
          apiKey: "AIzaSy" + "BnFNm4TK1nxKQVjg9AXXkrRoqs2AAO9yQ",
          authDomain: "ripzcreator-e.firebaseapp.com",
          projectId: "ripzcreator-e",
          storageBucket: "ripzcreator-e.firebasestorage.app",
          messagingSenderId: "681432437212",
          appId: "1:681432437212:web:e07ddb0ee8d5b53fa2ff19",
          measurementId: "G-B74RK9PSZM"
        };
        const GEMINI_API_KEY = "PASTE_YOUR_KEY_HERE"; // <--- PASTE GEMINI KEY HERE

        // --- Init ---
        let app, auth, db, user = null;
        let appId = 'ripz-creator-mvp';

        try {
            if (manualConfig) {
                app = initializeApp(manualConfig);
                auth = getAuth(app);
                db = getFirestore(app);
            }
        } catch (e) { console.warn("Firebase Init Error:", e); }

        // --- Navigation Logic ---
        window.switchView = (viewId) => {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-violet-600/20', 'text-violet-300', 'border', 'border-violet-600/50');
                btn.classList.add('text-zinc-400');
            });
            const activeBtn = document.getElementById(`nav-${viewId}`);
            if(activeBtn) {
                activeBtn.classList.remove('text-zinc-400');
                activeBtn.classList.add('bg-violet-600/20', 'text-violet-300', 'border', 'border-violet-600/50');
            }
            if(window.innerWidth < 768) toggleSidebar();
        };

        // --- Interactive Functions ---
        window.showToast = (msg, type = 'info') => {
            const box = document.getElementById('toast-box');
            const txt = document.getElementById('toast-text');
            const icon = document.getElementById('toast-icon');
            txt.innerText = msg;
            box.classList.remove('hidden');
            if(type === 'success') icon.style.color = '#4ade80';
            else if(type === 'error') icon.style.color = '#ef4444'; 
            else icon.style.color = '#a78bfa';
            setTimeout(() => box.classList.add('hidden'), 3000);
        };

        window.simulateDownload = () => {
            showToast("Starting Download... (Project.mp4)", 'success');
        };

        // Asset Lab Logic
        let selectedAssetType = 'Character';
        window.selectAssetType = (el, type) => {
            selectedAssetType = type;
            document.querySelectorAll('.asset-btn').forEach(b => {
                b.classList.remove('bg-violet-600', 'text-white', 'border-violet-500');
                b.classList.add('bg-zinc-900', 'text-zinc-400', 'border-zinc-800');
            });
            el.classList.remove('bg-zinc-900', 'text-zinc-400', 'border-zinc-800');
            el.classList.add('bg-violet-600', 'text-white', 'border-violet-500');
        };

        window.generateAsset = async () => {
            const prompt = document.getElementById('asset-prompt').value;
            const btn = document.getElementById('asset-gen-btn');
            const placeholder = document.getElementById('asset-placeholder');
            const result = document.getElementById('asset-result');
            const imagePreview = result.querySelector('.absolute.inset-0'); 
            
            if(!prompt) { showToast("Please describe the asset first.", 'error'); return; }
            
            btn.disabled = true;
            btn.innerText = "Generating...";
            
            const seed = Math.floor(Math.random() * 1000000);
            const finalPrompt = encodeURIComponent(`${prompt}, ${selectedAssetType}, anime style, high quality, 8k, vivid lighting`);
            const imageUrl = `https://image.pollinations.ai/prompt/${finalPrompt}?width=1280&height=720&seed=${seed}&nologo=true&model=flux`;

            try {
                const img = new Image();
                img.src = imageUrl;
                img.onload = () => {
                    placeholder.classList.add('hidden');
                    result.classList.remove('hidden');
                    document.getElementById('asset-title').innerText = selectedAssetType;
                    document.getElementById('asset-desc').innerText = prompt;
                    imagePreview.style.background = `url(${imageUrl})`;
                    imagePreview.style.backgroundSize = "cover";
                    imagePreview.style.backgroundPosition = "center";
                    btn.disabled = false;
                    btn.innerText = "Generate";
                    showToast("Asset Generated!", 'success');
                };
            } catch (error) {
                showToast("Generation Failed.", 'error');
                btn.disabled = false;
                btn.innerText = "Generate";
            }
        };

        // --- NEW: Scene Builder Logic (Real Multi-Shot) ---
        window.generateScene = async () => {
            const prompt = document.getElementById('scene-prompt').value;
            const btn = document.getElementById('scene-btn');
            const loading = document.getElementById('scene-loading');
            const results = document.getElementById('scene-results');
            
            if(!prompt) { showToast("Describe your scene first.", 'error'); return; }
            
            btn.disabled = true;
            loading.classList.remove('hidden');
            results.classList.add('hidden');
            
            const shots = [
                { type: "Wide Shot", detail: "cinematic establishing shot" },
                { type: "Action Shot", detail: "dynamic angle, motion blur" },
                { type: "Close Up", detail: "intense emotion, detailed eyes" }
            ];
            
            let html = '';
            
            // We use Promise.all to fetch 3 images in parallel
            const imagePromises = shots.map(async (shot) => {
                const seed = Math.floor(Math.random() * 1000000);
                const p = encodeURIComponent(`${prompt}, ${shot.type}, ${shot.detail}, anime style, 8k`);
                const url = `https://image.pollinations.ai/prompt/${p}?width=800&height=450&seed=${seed}&nologo=true&model=flux`;
                
                // Preload to ensure validity
                await new Promise((resolve) => {
                    const img = new Image();
                    img.src = url;
                    img.onload = resolve;
                });
                
                return `
                    <div class="glass-panel p-2 rounded-xl group relative overflow-hidden">
                        <div class="aspect-video bg-black rounded-lg bg-cover bg-center" style="background-image: url('${url}')"></div>
                        <div class="absolute bottom-2 left-2 bg-black/60 px-2 py-1 rounded text-[10px] text-white font-bold">${shot.type.toUpperCase()}</div>
                    </div>
                `;
            });

            try {
                const resultCards = await Promise.all(imagePromises);
                results.innerHTML = resultCards.join('');
                
                loading.classList.add('hidden');
                results.classList.remove('hidden');
                showToast("Storyboard Created!", 'success');
            } catch(e) {
                showToast("Scene Gen Failed", 'error');
                loading.classList.add('hidden');
            } finally {
                btn.disabled = false;
            }
        };

        // --- NEW: VFX Interactive Logic ---
        window.toggleVFX = (el, effectName) => {
            // 1. Update UI Buttons
            document.querySelectorAll('.vfx-btn').forEach(b => {
                b.classList.remove('border-violet-500', 'bg-zinc-900');
                b.classList.add('border-zinc-800', 'bg-zinc-950');
            });
            el.classList.remove('border-zinc-800', 'bg-zinc-950');
            el.classList.add('border-violet-500', 'bg-zinc-900');
            
            // 2. Hide all layers first
            ['aura', 'eyes', 'lines', 'impact'].forEach(fx => {
                document.getElementById(`vfx-layer-${fx}`).classList.add('opacity-0');
            });
            
            // 3. Show selected layer
            const layer = document.getElementById(`vfx-layer-${effectName}`);
            if(layer) layer.classList.remove('opacity-0');
            
            document.getElementById('vfx-hud').innerText = `ACTIVE FX: ${effectName.toUpperCase()}`;
            showToast(`${effectName.toUpperCase()} Effect Applied`, 'success');
        };


        // --- Magic Edit Logic (Simulation) ---
        window.startAutoEdit = () => {
            const upload = document.getElementById('upload-state');
            const process = document.getElementById('processing-state');
            const success = document.getElementById('success-state');
            const bar = document.getElementById('progress-bar');
            const log = document.getElementById('terminal-log');
            const stage = document.getElementById('process-stage');
            const percent = document.getElementById('process-percent');

            upload.classList.add('hidden');
            process.classList.remove('hidden');

            let progress = 0;
            const steps = [
                { p: 15, msg: "> Extracting Audio Track..." },
                { p: 30, msg: "> Detecting Beats (BPM: 128)..." },
                { p: 45, msg: "> Stabilizing Footage (Optical Flow)..." },
                { p: 60, msg: "> Applying Anime Color LUT..." },
                { p: 80, msg: "> Generating Captions..." },
                { p: 100, msg: "> Finalizing Render..." }
            ];

            let stepIndex = 0;
            
            const interval = setInterval(() => {
                progress += Math.floor(Math.random() * 2) + 1;
                if(progress > 100) progress = 100;
                
                bar.style.width = `${progress}%`;
                percent.innerText = `${progress}%`;

                if(stepIndex < steps.length && progress >= steps[stepIndex].p) {
                    log.innerHTML += `${steps[stepIndex].msg}<br>`;
                    stage.innerText = steps[stepIndex].msg.replace('> ', '').toUpperCase();
                    log.scrollTop = log.scrollHeight;
                    stepIndex++;
                }

                if(progress === 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        process.classList.add('hidden');
                        success.classList.remove('hidden');
                    }, 800);
                }
            }, 50);
        };

        window.resetAutoEdit = () => {
            document.getElementById('success-state').classList.add('hidden');
            document.getElementById('upload-state').classList.remove('hidden');
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('terminal-log').innerHTML = '> Init AI Core...<br>';
        };

        // --- Shared Logic ---
        window.toggleSidebar = () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        };

        window.copyText = (text) => {
            const temp = document.createElement("textarea");
            temp.value = text;
            document.body.appendChild(temp);
            temp.select();
            document.execCommand("copy");
            document.body.removeChild(temp);
            showToast("Copied to Clipboard");
        };
        
        window.resetCreator = () => switchView('script');
        
        window.showError = (msg) => {
            showToast(msg, 'error');
        };

        // --- Auth & Listeners ---
        window.handleEmailAuth = async (mode) => {
            const e = document.getElementById('email-input').value;
            const p = document.getElementById('password-input').value;
            if(!auth) return;
            try {
                if (mode === 'signup') await createUserWithEmailAndPassword(auth, email, password);
                else await signInWithEmailAndPassword(auth, email, password);
            } catch (e) { showError(e.message); }
        };

        window.handleGuestLogin = async () => {
            if(!auth) { user = {uid:'demo', isAnonymous:true}; updateAuthUI(); return; }
            try { await signInAnonymously(auth); } 
            catch (e) { 
                if(e.code.includes('admin-restricted')) { user = {uid:'demo', isAnonymous:true}; updateAuthUI(); return; }
                showError(e.message);
            }
        };

        window.handleSignOut = () => { if(auth) signOut(auth); else window.location.reload(); };

        function updateAuthUI() {
            document.getElementById('loading-screen').classList.add('hidden');
            if(user) {
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('user-email').innerText = user.email || "Guest User";
                document.getElementById('user-avatar').innerText = (user.email||'G').substring(0,2).toUpperCase();
                if(auth && db) subscribeHistory();
            } else {
                document.getElementById('login-view').classList.remove('hidden');
                if(!auth) document.getElementById('setup-warning').classList.remove('hidden');
            }
        }

        // --- Existing Script Logic (Preserved) ---
        window.generateContent = async () => {
             const topic = document.getElementById('topic-input').value.trim();
             const toneSelect = document.getElementById('tone-select');
             const tone = toneSelect.options[toneSelect.selectedIndex].text;
             const btn = document.getElementById('generate-btn');
             const resultsDiv = document.getElementById('results-container');
             const apiKeyWarning = document.getElementById('api-key-warning');

             if (!topic) return;

             // Check API Key
             if (!GEMINI_API_KEY && typeof window.GEMINI_API_KEY === 'undefined') {
                  apiKeyWarning.classList.remove('hidden');
                  return;
             }
             apiKeyWarning.classList.add('hidden');

             btn.disabled = true;
             btn.innerHTML = '<div class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>';
             resultsDiv.classList.add('hidden');

             const systemInstruction = `
                You are RipzCreator-E, an elite AI specialized EXCLUSIVELY in Anime, Manga, and Aesthetic YouTube content.
                Your goal: High Retention (AVD).
                Tone: ${tone}.
                Output: JSON ONLY.
                Structure: 
                {
                    "title": "Viral Title",
                    "hooks": ["Hook 1", "Hook 2"],
                    "script": [{"time": "0:00", "section": "Intro", "visual": "...", "audio": "..."}],
                    "thumbnail_prompt": "Midjourney Prompt",
                    "tags": ["tag1", "tag2"]
                }
            `;
            const userPrompt = `Topic: ${topic}\nTone: ${tone}\nGenerate video package.`;

            try {
                const finalKey = GEMINI_API_KEY || "";
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${finalKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                if (!response.ok) throw new Error("API Error");
                const data = await response.json();
                let text = data.candidates[0].content.parts[0].text;
                text = text.replace(/```json/g, '').replace(/```/g, '').trim();
                const content = JSON.parse(text);

                renderResults(content);
                
                if (user && auth && db && user.uid !== 'demo-user') {
                    addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'projects'), {
                        topic,
                        tone,
                        type: 'full-package',
                        content,
                        timestamp: serverTimestamp()
                    });
                }
            } catch (err) {
                console.error(err);
                showToast("Generation Failed. Check API Key.", 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i data-lucide="sparkles" class="w-4 h-4"></i> Generate';
                lucide.createIcons();
            }
        };

        function renderResults(data) {
            const container = document.getElementById('results-container');
            const safeTxt = (txt) => txt.replace(/"/g, '&quot;');
            
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-panel rounded-2xl p-6 relative group hover:border-violet-500/50 transition-colors">
                        <button onclick="copyText('${safeTxt(data.title)}')" class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-zinc-800 rounded-lg hover:bg-violet-600 text-white"><i data-lucide="copy" class="w-4 h-4"></i></button>
                        <h3 class="flex items-center gap-2 text-zinc-400 text-sm font-semibold mb-3"><i data-lucide="youtube" class="w-4 h-4"></i> Viral Title</h3>
                        <p class="text-xl font-bold text-white leading-tight">${data.title}</p>
                        <div class="mt-4 flex flex-wrap gap-2">${data.tags.map(t => `<span class="text-xs bg-zinc-800 text-zinc-400 px-2 py-1 rounded-md">#${t}</span>`).join('')}</div>
                    </div>
                    <div class="glass-panel rounded-2xl p-6 relative group hover:border-violet-500/50 transition-colors">
                         <button onclick="copyText('${safeTxt(data.thumbnail_prompt)}')" class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity p-2 bg-zinc-800 rounded-lg hover:bg-violet-600 text-white"><i data-lucide="copy" class="w-4 h-4"></i></button>
                        <h3 class="flex items-center gap-2 text-zinc-400 text-sm font-semibold mb-3"><i data-lucide="image" class="w-4 h-4"></i> Thumbnail Prompt</h3>
                        <div class="bg-black/30 p-3 rounded-lg border border-zinc-800/50"><p class="text-sm text-indigo-300 font-mono italic">/imagine prompt: ${data.thumbnail_prompt} --ar 16:9 --v 6.0</p></div>
                    </div>
                </div>
                <div class="glass-panel rounded-2xl overflow-hidden">
                    <div class="p-6 border-b border-violet-500/10 flex justify-between items-center bg-zinc-900/50 backdrop-blur-md">
                        <h3 class="flex items-center gap-2 text-zinc-400 text-sm font-semibold"><i data-lucide="type" class="w-4 h-4"></i> Script</h3>
                        <button onclick='copyText(${JSON.stringify(JSON.stringify(data.script))})' class="flex items-center gap-2 px-3 py-1.5 bg-violet-600 hover:bg-violet-500 text-white text-xs font-bold rounded-lg transition-colors"><i data-lucide="copy" class="w-3 h-3"></i> Copy</button>
                    </div>
                    <div class="divide-y divide-zinc-800">
                        ${data.script.map(block => `
                        <div class="p-6 grid grid-cols-1 md:grid-cols-12 gap-6 hover:bg-zinc-800/30 transition-colors">
                            <div class="md:col-span-4 space-y-2">
                                <span class="inline-block px-2 py-1 bg-zinc-800 text-zinc-400 text-[10px] font-bold uppercase tracking-wider rounded">${block.time}</span>
                                <div class="bg-black/20 p-3 rounded-lg border border-zinc-800/50">
                                    <div class="flex items-start gap-2"><i data-lucide="film" class="w-3 h-3 text-violet-400 mt-1 shrink-0"></i><p class="text-xs text-zinc-400 italic">${block.visual}</p></div>
                                </div>
                            </div>
                            <div class="md:col-span-8"><h4 class="text-violet-400 text-xs font-bold uppercase mb-2 tracking-wide">${block.section}</h4><p class="text-zinc-200 leading-7 text-sm whitespace-pre-wrap">${block.audio}</p></div>
                        </div>`).join('')}
                    </div>
                </div>
            `;
            container.classList.remove('hidden');
            lucide.createIcons();
        }

        function subscribeHistory() {
            if(!user || user.uid === 'demo') return;
            try {
                const q = query(collection(db, 'artifacts', appId, 'users', user.uid, 'projects'), orderBy('timestamp', 'desc'));
                onSnapshot(q, (snapshot) => {
                    const list = document.getElementById('history-list');
                    if(snapshot.empty) { list.innerHTML = '<p class="px-4 text-xs text-zinc-600 italic">No history yet.</p>'; return; }
                    list.innerHTML = snapshot.docs.map(doc => `
                        <button class="w-full text-left px-4 py-2 text-sm text-zinc-400 hover:bg-zinc-900 hover:text-white rounded-lg truncate flex items-center gap-2 group">
                            <i data-lucide="history" class="w-3 h-3 min-w-[12px] group-hover:text-violet-500"></i> <span class="truncate">${doc.data().topic || "Untitled"}</span>
                        </button>`).join('');
                    lucide.createIcons();
                });
            } catch (e) { console.log('DB error'); }
        }

        if(auth) onAuthStateChanged(auth, (u) => { user = u; updateAuthUI(); });
        else setTimeout(updateAuthUI, 1000); // Simulate load
        
        lucide.createIcons();
    </script>
</body>
</html>
